### 第一章 浏览器生成消息
* 名词缩写
    - URL：Uniform Resource Locator
    - FTP：File Transfer Protocol
    - HTTP：Hypertext Transfer Protocol
    - URI：Uniform Resource Identifier
    - DNS：Domain Name System

* 省略路径会访问默认文件，比如：index.html。
* 浏览器的第一步工作就是对 URL 进行解析。
* HTTP 消息包含：资源路径（对什么） + 动作（做什么）。
* HTTP Method：
    - GET: 资源获取。
    - POST：用于客户端向服务端发送数据。
    - DELETE：输出。
    - PUT：替换文件，若不存在则新建。
    - HEAD：获取 header 的信息。
* HTTP 请求消息：
    - 请求行。
    - 消息头。
    - 消息体。
* HTTP 相应消息：
    - 状态行。
    - 消息头。
    - 消息体。

* HTTP 状态码
    - 1xx：告知请求的处理进度和情况。
    - 2xx：成功。
    - 3xx：需要进一步操作。
    - 4xx：客户端错误。
    - 5xx：服务器错误。
* 一条请求消息只能写一个 URI。如果需要获取多个文件，必须每个文件单独发送一条请求。
* IP 地址的主机号
    - 全 0：表示整个子网。
    - 全 1：表示向子网所有设备发包，即广播。
* DNS 查询信息
    - 域名、Class、记录类型
* DNS 查询：客户端 -> 最近的 DNS 服务器 -> 根域 -> 下一级域... -> 目标 DNS 服务器。
* DNS 查询优化：缓存查询结果；且缓存有有效期，防止缓存数据已改变。
* 收发数据的 4 个操作
    - 创建套接字
    - 连接服务器的套接字
    - 收发数据
    - 断开管道，删除套接字
* 应用程序通过描述符来识别套接字。
* 描述符用于计算机内部识别套接字；端口号用于服务器识别套接字。
* web 端口号： 80；电子邮件端口号：25。

### 第二章 用电信号传输 TCP/IP 数据
* 名词缩写
    - TCP： Transmission Control Protocol
    - UDP：User Datagram Protocol
    - ICMP：Internet Message Protocol
    - IP：Internet Protocol
    - ARP：Address Resolution Protocol
    - MTU：Maximum Transmission Unit，一般为 1500 字节。
    - MSS：Maximum Segment Size
    - FCS：Frame Check Sequence

#### TCP
* 协议栈是根据套接字中记录的控制信息来工作的。
* 创建套接字时，先分配内存空间，然后向其中写入初始状态。
* 连接做的两件事：交换控制信息；创建内存空间。
* 通信操作中的控制信息分两类：
    - 头部中记录的信息。
    - 套接字（协议栈中的内存空间）中记录的信息。
* 缓存区何时发送数据判断两要素：
    - 网络包的长度。
    - 时间。
* 通过 序号 和 ACK号 可以确认接收方是否收到了网络包。
* TCP 会动态调整 ACK号 的等待时间。
* 滑动窗口来优化 ACK号 等待的时间。基本思路：接收方告知发送方能接受多少数据，发送方根据这个值来控制发送操作。
* 套接字会等待一段时间（一般为几分钟）后才删除，为什么？
答：防止误删。假设客户端最后的 ACK 号丢失，那服务器就会重发 FIN 包，而如果这时客户端的套接字已经删除，并把端口号分配了一个新的套接字，那这个新的套接字就会开始执行断开操作了。

#### IP
* 包的内容：头部 + 数据。
* IP 和以太网的分层是为了保证网络架构上的灵活性，比如以太网可以替换为无线局域网、ADSL等。
* IP 模块负责添加两个头部：IP 头部和 MAC 头部。
* IP 模块对 TCP模块传递的内容不会校验，只是单纯的负责发送数据，至于送没送到也不会关心。

#### 以太网
* 使用 ARP 来通过 IP 地址获取 MAC 地址。ARP会用广播的方式发给所有设备，且为了提高效率，它会缓存结果。每次获取 MAC 地址时会先从缓存找，找不到再去广播。为防止缓存数据失效，一般缓存的数据会在几分钟后被全部删除。
* 以太网类型：
    - 0800：IP 协议。
    - 0806：ARP。
    - 86DD：IPv6。
* MAC 头部信息：
    - 接收方 MAC 地址。
    - 发送方 MAC 地址。
    - 以太网类型。

* 网卡的 ROM 中保存着全世界唯一的 MAC 地址，是在生产网卡时写入的。MAC 地址会由网卡驱动程序读取并分配给 MAC 模块。
* MAC 模块会在数据报开头添加报头和起始帧分界符，在尾部添加用于检查错误的 FCS。
* 发送信号的两种方式：半双工和全双工。

#### UDP
* UDP 无连接，不负责错误校验，效率高。头部控制信息：
    - 发送方端口号
    - 接收方端口号
    - 数据长度
    - 校验和

### 第三章 集线器、交换机、路由器
### 第四章 接入网、网络运营商
### 第五章 防火墙、缓存服务器

#### 防火墙
* 包过滤：根据头部控制信息来进行设置。
* 包过滤方式的防火墙可根据接收方、发送方的 IP 地址，端口号，控制位等信息来判断是否允许某个包通过。

#### 负载均衡
* 服务器性能不足时，需使用负载均衡：
    - 通过 DNS 服务器轮训返回 IP 地址，缺点：不能自动跳过有故障的服务器。
    - 负载均衡器：通过将负载均衡器替代 Web 服务器注册到 DNS 服务器，实现客户端请求指到负载均衡器。再由负载均衡器根据一定的规则去请求相应服务器。

#### 缓存服务器
* 通过缓存的数据来提升服务器的性能。将缓存服务器替代 Web 服务器注册到 DNS 服务器。
* 流程：
    - 无缓存：client -> cache server -> web server；web server -> cache server(缓存数据) -> client。
    - 有缓存：client -> cache server -> web server；web server(数据无更新) -> cache server(直接返回缓存的数据) -> client。
    - 若数据有更新，流程同 无缓存。
* 通过 Via 头部字段表明消息是经过缓存服务器中转的。
* 正向代理：
    - 放在客户端一侧，通过代理禁止员工访问危险的网站，或者与工作无关的网站。
    - 没有代理时，URI 只包含文件或目录名；有代理时，则是完整网址。
* 反向代理：将请求信息中的 URI 中的目录名与 Web 服务器进行关联，使得代理能够转发一般的不包含完整网址的请求消息。
* 透明代理：查看请求消息的包头部来判断访问哪台服务器。

#### CDS - 内容分发服务
* CDS 寻找服务器的策略：
    - 通过 DNS 来分发。
    - 通过重定向。

### 第六章 Web 服务器
* 服务器初始状态为等待连接的状态，每进来一个请求都会新创建一个套接字进行连接。
* 发起连接的一方为客户端，等待连接的一方为服务端。
* 通过创建等待连接套接字的副本，来让服务器一直保持等待连接的状态。
* 使用描述符的原因：
    - 等待连接的套接字中没有客户端的 IP 地址和端口号。
    - 使用描述符信息比较简单。
* 服务器接收流程：
    - 网卡的 MAC 模块将网络包从信号还原为数字信息，校验 FCS 并存入缓存区。
    - 网卡驱动根据 MAC 头部判断协议类型，并将包交给相应的协议栈。
    - 协议栈 IP 会检查 IP 头部，1）判断是不是发给自己的；2）判断网络包是否经过分片；3）将包转给 TCP 或 UDP。
    - 如果收到发起连接的包，则 TCP 模块会，1）确认 TCP 头部的控制为 SYN；2）检查接收方端口号；3）为相应的等待连接套接字复制一个新的副本；4）记录发送方 IP 地址和端口号等信息。
    - 收到数据包时，TCP 模块会，1）根据收到的包的发送方 IP 地址、发送方端口号、接受方 IP 地址、接收方端口号找到相应的套接字；2）将数据拼合保存到缓冲区；3）向客户端返回 ACK。
* Web 服务器访问控制规则：
    - 客户端 IP 地址
    - 客户端域名
    - 用户名和密码
* 客户端根据 Content-Type 字段来区分资源类型。